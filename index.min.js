var set=function(t,e,i){var n=assign({},i);return n[t]=e,n},assign=Object.assign||function(t){for(var e=1;e<arguments.length;e+=1){var i=arguments[e];for(var n in i)t[n]=i[n]}return t},isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function generateData(t){return Object.keys(t).reduce(function(e,i){return set(i,{isRunning:!1,time:t[i].time||0,instance:null},e)},{})}function setTimer(t){return t?setInterval:setTimeout}function clearTimer(t){return t?clearInterval:clearTimeout}function generateTimer(t,e){return setTimer(t.repeat)(function(){e.$emit("timer-tick:"+t.name),t.callback()},t.time)}function normalizeConfig(t,e){if("production"!==process.env.NODE_ENV){if(!t.name)throw new Error("[vue-timers.create] name is required");if(!t.callback&&"function"!=typeof e[t.name])throw new ReferenceError("[vue-timers.create] Cannot find method "+t.name);if(t.callback&&"function"!=typeof t.callback)throw new TypeError("[vue-timers.create] Timer callback should be a function, "+_typeof(t.callback)+" given")}return{name:t.name,time:t.time||0,repeat:"repeat"in t&&t.repeat,immediate:"immediate"in t&&t.immediate,autostart:"autostart"in t&&t.autostart,isSwitchTab:"isSwitchTab"in t&&t.isSwitchTab,callback:t.callback&&t.callback.bind(e)||e[t.name]}}function normalizeOptions(t,e){return isArray(t)?t.reduce(function(t,i){return set(i.name,normalizeConfig(i,e),t)},{}):Object.keys(t).reduce(function(i,n){return set(n,normalizeConfig(set("name",n,t[n]),e),i)},{})}var VueTimers={data:function(){return this.$options.timers?(this.$options.timers=normalizeOptions(this.$options.timers,this),{timers:generateData(this.$options.timers)}):{}},created:function(){if(this.$options.timers){var t=this,e=t.timers,i=t.$options.timers;t.$timer={start:function(n){if("production"!==process.env.NODE_ENV&&!(n in i))throw new ReferenceError("[vue-timers.start] Cannot find timer "+n);e[n].isRunning||(e[n].isRunning=!0,e[n].instance=generateTimer(set("time",e[n].time,i[n]),t),i[n].immediate&&(t.$emit("timer-tick:"+n),i[n].callback()),t.$emit("timer-start:"+n))},stop:function(n){if("production"!==process.env.NODE_ENV&&!(n in i))throw new ReferenceError("[vue-timers.stop] Cannot find timer "+n);e[n].isRunning&&(clearTimer(i[n].repeat)(e[n].instance),e[n].isRunning=!1,t.$emit("timer-stop:"+n))},restart:function(e){if("production"!==process.env.NODE_ENV&&!(e in i))throw new ReferenceError("[vue-timers.restart] Cannot find timer "+e);this.stop(e),this.start(e),t.$emit("timer-restart:"+e)}}}},mounted:function(){if(this.$options.timers){var t=this,e=t.$options.timers;Object.keys(e).forEach(function(i){e[i].autostart&&t.$timer.start(i)})}},activated:function(){if(this.$options.timers){var t=this,e=t.timers,i=t.$options.timers;Object.keys(i).forEach(function(n){i[n].isSwitchTab&&e[n].instance&&t.$timer.start(n)})}},deactivated:function(){if(this.$options.timers){var t=this,e=t.timers,i=t.$options.timers;Object.keys(i).forEach(function(n){i[n].isSwitchTab&&e[n].instance&&t.$timer.stop(n)})}},beforeDestroy:function(){if(this.$options.timers){var t=this;Object.keys(t.$options.timers).forEach(function(e){t.$timer.stop(e)})}}};function index(t){t.config.optionMergeStrategies.timers=t.config.optionMergeStrategies.methods,t.mixin(VueTimers)}function timer(t,e,i){return assign({name:t,time:e},i)}var mixin=VueTimers;export default index;export{timer,mixin};
